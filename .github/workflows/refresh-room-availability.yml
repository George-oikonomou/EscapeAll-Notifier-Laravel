name: Refresh Room Availability (On-Demand)

on:
  workflow_dispatch:
    inputs:
      room_external_id:
        description: 'External ID of the room to refresh'
        required: true
        type: string
      room_title:
        description: 'Room title (for logging)'
        required: false
        type: string
        default: 'Unknown Room'

jobs:
  refresh-room:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install automation dependencies
        working-directory: node/automation
        run: npm install

      - name: Install Playwright Chromium
        working-directory: node/automation
        run: npx playwright install chromium

      - name: Refresh availability for room
        working-directory: node/scripts
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
          WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
        run: |
          echo "Refreshing: ${{ inputs.room_title }} (${{ inputs.room_external_id }})"
          node refresh-room-availability.js \
            webhookUrl="${WEBHOOK_URL}/api/webhook/sync-availability" \
            webhookSecret="${WEBHOOK_SECRET}" \
            serviceId="${{ inputs.room_external_id }}" \
            months=10
